我先快速查看现有项目里可复用的关键模块实现方式（文本注入、VAD/录音、日志、热键等），以便给出“可复用 vs 需重写”的清单与新项目架构建议。随后我会给出任务分解和实施里程碑。

[3 tools called]

我看完了 `clipboard.js`、`hotkeyManager.js`、`logManager.js` 和现有的 `funasr_server.py` 的要点，可以直接借鉴热键/文本注入/日志与 FunASR 启动策略。下面给你一份精炼的执行规划和“可复用 vs 需重写”清单。

### 项目整体规划（无 GUI，Windows 专注，ASR-only）
- 架构
  - 单进程 Python CLI/常驻进程。
  - 模块：热键管理 → 录音缓冲（会话）→ 单次转写 → 文本输出(粘贴/打字) → 日志。
- 数据流
  - F2 切换会话：开始录音清状态；再次 F2 停止采集，合并会话音频为整段 WAV → 单次转写 → 注入文本。
  - 不再进行实时分段与队列消费，降低复杂度，提升整段识别准确度。
  - 输出策略：优先“粘贴”，失败降级“逐字符打字”。
- 模型与适配
  - 初期只接 FunASR（ASR+VAD+PUNC 可选），接口抽象为 `IAsrBackend.transcribe(wav_path, opts)->{text,confidence}`。
  - 预留 `whisper/faster-whisper`、纯 ONNX 的适配接口；通过配置选择模型/后端。
- 日志与诊断
  - 路径：`/logs`，文件：`app.log`、`recent.wav`。
  - 记录热键/录音开始结束/整段样本数/转录耗时/输出动作；保存最近一次会话音频到 `recent.wav`。

### 现有项目“可直接借鉴/迁移”的部分
- 文本注入的降级策略与粘贴优先方案
- FunASR 预初始化与并行加载模型的做法
  - 参考 `funasr_server.py` 中三个模型并行加载、一次常驻、后续复用；在新工程启动时完成加载，减少首段延迟。
- 模型下载/校验理念
  - 直接复用你仓库的 `download_models.py` 作为一键准备脚本（可选），或迁移其“按行 JSON 进度输出”的做法。

### 需要重写/新开发的部分（Python 实现）
- 热键与会话控制（无 Electron）
  - 全局 F2 切换；Ctrl+Alt+S 保存最近会话到 `log/recent.wav`。建议 `keyboard` 或 `pywin32`。
- 会话式采集与优雅停止
  - `sounddevice` WASAPI 采集；仅缓冲音频帧。
  - 停止录音后一次性合并缓冲并进行单次转写与输出。
- 文本输出（Windows）
  - 方案A：剪贴板粘贴（首选）；`pywin32`/`ctypes` 模拟 Ctrl+V，恢复原剪贴板内容。
  - 方案B：逐字符 `SendInput`；对中文 IME 可能有副作用，仅作兜底。
- ASR 适配层
  - `FunASRBackend`：`AutoModel(...).generate()`；提供语言、批量秒数、热词参数。
- 诊断与指标
  - 记录“开始→停止→合并→转写→注入”的时间线；打印推理耗时。

### 技术选型（Python）
- 音频：sounddevice 或 soundcard（WASAPI），numpy
- ASR：funasr>=1.2.7，torch/torchaudio，librosa，numpy<2
- 热键/注入：keyboard + pywin32 或 ctypes SendInput，pyperclip 作为剪贴板备选
- 日志：logging（JSON formatter 可选）
- 打包：PyInstaller（单文件可选），或 uv 打包环境

### 配置示例（config.json）
```json
{
  "hotkeys": { "toggle": "f2", "dump_last": "ctrl+alt+s" },
  "audio": { "sr": 16000, "block_ms": 20, "device": "default" },
  "asr": { "backend": "funasr", "use_punc": true, "language": "auto" },
  "output": { "method": "auto", "dedupe": true },
  "logging": { "dir": "/logs", "level": "info" }
}
```

### 里程碑与验收
- M1 基础通路（3–5 天）
  - 录音 → 文件落地 → FunASR 单次转写 → 粘贴/打字输出；F2 开/关，日志落地。
- M2（单次转写模式，2–3 天）
  - 会话缓冲与合并、单次转写、输出与日志；recent.wav 导出；配置化输出策略。
- M3 稳定性与性能（3–5 天）
  - 异常处理（无设备、权限）、超时与重试、平均转写耗时指标；配置化。
- M4 可扩展后端（可选）
  - 增加 `WhisperBackend` 或 `ONNXBackend`，接口保持不变；配置切换。

### 你关心的点逐条落地
- F2 开始/停止：开始时清状态，停止后合并并单次转写，避免重复与丢失。
- 准确率优先：整段提交，减少切分误差；必要时可在停止后追加标点恢复。
- 非 GUI：纯 CLI/后台进程；后续若要 GUI，仅包一层设置面板即可。
- “像 Ollama 一样可换模型”：通过后端适配器 + 配置选择，先 FunASR，后续加 whisper/onnx 也无需改上层。