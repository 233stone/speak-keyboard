æˆ‘å…ˆå¿«é€ŸæŸ¥çœ‹çŽ°æœ‰é¡¹ç›®é‡Œå¯å¤ç”¨çš„å…³é”®æ¨¡å—å®žçŽ°æ–¹å¼ï¼ˆæ–‡æœ¬æ³¨å…¥ã€VAD/å½•éŸ³ã€æ—¥å¿—ã€çƒ­é”®ç­‰ï¼‰ï¼Œä»¥ä¾¿ç»™å‡ºâ€œå¯å¤ç”¨ vs éœ€é‡å†™â€çš„æ¸…å•ä¸Žæ–°é¡¹ç›®æž¶æž„å»ºè®®ã€‚éšåŽæˆ‘ä¼šç»™å‡ºä»»åŠ¡åˆ†è§£å’Œå®žæ–½é‡Œç¨‹ç¢‘ã€‚

[3 tools called]

æˆ‘çœ‹å®Œäº† `clipboard.js`ã€`hotkeyManager.js`ã€`logManager.js` å’ŒçŽ°æœ‰çš„ `funasr_server.py` çš„è¦ç‚¹ï¼Œå¯ä»¥ç›´æŽ¥å€Ÿé‰´çƒ­é”®/æ–‡æœ¬æ³¨å…¥/æ—¥å¿—ä¸Ž FunASR å¯åŠ¨ç­–ç•¥ã€‚ä¸‹é¢ç»™ä½ ä¸€ä»½ç²¾ç‚¼çš„æ‰§è¡Œè§„åˆ’å’Œâ€œå¯å¤ç”¨ vs éœ€é‡å†™â€æ¸…å•ã€‚

### é¡¹ç›®æ•´ä½“è§„åˆ’ï¼ˆæ—  GUIï¼ŒWindows ä¸“æ³¨ï¼ŒASR-onlyï¼‰âœ… å·²å®Œæˆ v2.0
- æž¶æž„
  - å•è¿›ç¨‹ Python CLI/å¸¸é©»è¿›ç¨‹ã€‚
  - æ¨¡å—ï¼šçƒ­é”®ç®¡ç† â†’ å½•éŸ³ç¼“å†²ï¼ˆä¼šè¯ï¼‰â†’ **å¼‚æ­¥è½¬å†™é˜Ÿåˆ—** â†’ æ–‡æœ¬è¾“å‡º(ç²˜è´´/æ‰“å­—) â†’ æ—¥å¿—ã€‚
  - **v2.0 æ–°å¢ž**ï¼šç‹¬ç«‹è½¬å½•å·¥ä½œçº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—æœºåˆ¶ï¼Œçº¿ç¨‹å®‰å…¨ä¿æŠ¤
- æ•°æ®æµ (v2.0 ä¼˜åŒ–)
  - F2 åˆ‡æ¢ä¼šè¯ï¼šå¼€å§‹å½•éŸ³æ¸…çŠ¶æ€ï¼›å†æ¬¡ F2 åœæ­¢é‡‡é›†ï¼ˆç«‹å³è¿”å›ž~50msï¼‰
  - éŸ³é¢‘æäº¤åˆ°å¼‚æ­¥é˜Ÿåˆ— â†’ åŽå°è½¬å½•çº¿ç¨‹å¤„ç† â†’ æŒ‰é¡ºåºè¾“å‡ºæ–‡æœ¬
  - **å…³é”®æ”¹è¿›**ï¼šåœæ­¢å½•éŸ³ç«‹å³è¿”å›žï¼Œç”¨æˆ·å¯é©¬ä¸Šå¼€å§‹ä¸‹ä¸€æ¬¡å½•éŸ³ï¼Œè½¬å½•åœ¨åŽå°è¿›è¡Œ
  - æ”¯æŒå¿«é€Ÿè¿žç»­å½•éŸ³ï¼Œæœ€å¤š10ä¸ªä»»åŠ¡æŽ’é˜Ÿï¼ŒæŒ‰æäº¤é¡ºåºä¾æ¬¡å¤„ç†
  - è¾“å‡ºç­–ç•¥ï¼šä¼˜å…ˆ"ç²˜è´´"ï¼Œå¤±è´¥é™çº§"é€å­—ç¬¦æ‰“å­—"ã€‚
- æ¨¡åž‹ä¸Žé€‚é…
  - åˆæœŸåªæŽ¥ FunASRï¼ˆASR+VAD+PUNC å¯é€‰ï¼‰ï¼ŒæŽ¥å£æŠ½è±¡ä¸º `IAsrBackend.transcribe(wav_path, opts)->{text,confidence}`ã€‚
  - é¢„ç•™ `whisper/faster-whisper`ã€çº¯ ONNX çš„é€‚é…æŽ¥å£ï¼›é€šè¿‡é…ç½®é€‰æ‹©æ¨¡åž‹/åŽç«¯ã€‚
- æ—¥å¿—ä¸Žè¯Šæ–­
  - è·¯å¾„ï¼š`logs/`ï¼Œæ–‡ä»¶ï¼š`app.log`ã€`recent.wav`ã€‚
  - è®°å½•çƒ­é”®/å½•éŸ³å¼€å§‹ç»“æŸ/æ•´æ®µæ ·æœ¬æ•°/è½¬å½•è€—æ—¶/è¾“å‡ºåŠ¨ä½œï¼›åœæ­¢å½•éŸ³åŽè‡ªåŠ¨ä¿å­˜æœ€è¿‘ä¸€æ¬¡ä¼šè¯éŸ³é¢‘åˆ° `logs/recent.wav`ï¼ˆè¦†ç›–ï¼‰ã€‚

### çŽ°æœ‰é¡¹ç›®â€œå¯ç›´æŽ¥å€Ÿé‰´/è¿ç§»â€çš„éƒ¨åˆ†
- æ–‡æœ¬æ³¨å…¥çš„é™çº§ç­–ç•¥ä¸Žç²˜è´´ä¼˜å…ˆæ–¹æ¡ˆ
- FunASR é¢„åˆå§‹åŒ–ä¸Žå¹¶è¡ŒåŠ è½½æ¨¡åž‹çš„åšæ³•
  - å‚è€ƒ `funasr_server.py` ä¸­ä¸‰ä¸ªæ¨¡åž‹å¹¶è¡ŒåŠ è½½ã€ä¸€æ¬¡å¸¸é©»ã€åŽç»­å¤ç”¨ï¼›åœ¨æ–°å·¥ç¨‹å¯åŠ¨æ—¶å®ŒæˆåŠ è½½ï¼Œå‡å°‘é¦–æ®µå»¶è¿Ÿã€‚
- æ¨¡åž‹ä¸‹è½½/æ ¡éªŒç†å¿µ
  - ç›´æŽ¥å¤ç”¨ä½ ä»“åº“çš„ `download_models.py` ä½œä¸ºä¸€é”®å‡†å¤‡è„šæœ¬ï¼ˆå¯é€‰ï¼‰ï¼Œæˆ–è¿ç§»å…¶â€œæŒ‰è¡Œ JSON è¿›åº¦è¾“å‡ºâ€çš„åšæ³•ã€‚

### éœ€è¦é‡å†™/æ–°å¼€å‘çš„éƒ¨åˆ†ï¼ˆPython å®žçŽ°ï¼‰
- çƒ­é”®ä¸Žä¼šè¯æŽ§åˆ¶ï¼ˆæ—  Electronï¼‰
  - å…¨å±€ F2 åˆ‡æ¢ï¼›åœæ­¢å½•éŸ³åŽè‡ªåŠ¨ä¿å­˜æœ€è¿‘ä¼šè¯åˆ° `logs/recent.wav`ï¼ˆè¦†ç›–ï¼‰ã€‚å»ºè®® `keyboard` æˆ– `pywin32`ã€‚
- ä¼šè¯å¼é‡‡é›†ä¸Žä¼˜é›…åœæ­¢
  - `sounddevice` WASAPI é‡‡é›†ï¼›ä»…ç¼“å†²éŸ³é¢‘å¸§ã€‚
  - åœæ­¢å½•éŸ³åŽä¸€æ¬¡æ€§åˆå¹¶ç¼“å†²å¹¶è¿›è¡Œå•æ¬¡è½¬å†™ä¸Žè¾“å‡ºã€‚
- æ–‡æœ¬è¾“å‡ºï¼ˆWindowsï¼‰
  - æ–¹æ¡ˆAï¼šå‰ªè´´æ¿ç²˜è´´ï¼ˆé¦–é€‰ï¼‰ï¼›`pywin32`/`ctypes` æ¨¡æ‹Ÿ Ctrl+Vï¼Œæ¢å¤åŽŸå‰ªè´´æ¿å†…å®¹ã€‚
  - æ–¹æ¡ˆBï¼šé€å­—ç¬¦ `SendInput`ï¼›å¯¹ä¸­æ–‡ IME å¯èƒ½æœ‰å‰¯ä½œç”¨ï¼Œä»…ä½œå…œåº•ã€‚
- ASR é€‚é…å±‚
  - `FunASRBackend`ï¼š`AutoModel(...).generate()`ï¼›æä¾›è¯­è¨€ã€æ‰¹é‡ç§’æ•°ã€çƒ­è¯å‚æ•°ã€‚
- è¯Šæ–­ä¸ŽæŒ‡æ ‡
  - è®°å½•â€œå¼€å§‹â†’åœæ­¢â†’åˆå¹¶â†’è½¬å†™â†’æ³¨å…¥â€çš„æ—¶é—´çº¿ï¼›æ‰“å°æŽ¨ç†è€—æ—¶ã€‚

### æŠ€æœ¯é€‰åž‹ï¼ˆPythonï¼‰
- éŸ³é¢‘ï¼šsounddevice æˆ– soundcardï¼ˆWASAPIï¼‰ï¼Œnumpy
- ASRï¼šfunasr>=1.2.7ï¼Œtorch/torchaudioï¼Œlibrosaï¼Œnumpy<2
- çƒ­é”®/æ³¨å…¥ï¼škeyboard + pywin32 æˆ– ctypes SendInputï¼Œpyperclip ä½œä¸ºå‰ªè´´æ¿å¤‡é€‰
- æ—¥å¿—ï¼šloggingï¼ˆJSON formatter å¯é€‰ï¼‰
- æ‰“åŒ…ï¼šPyInstallerï¼ˆå•æ–‡ä»¶å¯é€‰ï¼‰ï¼Œæˆ– uv æ‰“åŒ…çŽ¯å¢ƒ

### é…ç½®ç¤ºä¾‹ï¼ˆconfig.jsonï¼‰
```json
{
  "hotkeys": { "toggle": "f2" },
  "audio": { "sr": 16000, "block_ms": 20, "device": "default" },
  "asr": { "backend": "funasr", "use_punc": true, "language": "auto" },
  "output": { "method": "auto", "dedupe": true },
  "logging": { "dir": "/logs", "level": "info" }
}
```

### é‡Œç¨‹ç¢‘ä¸ŽéªŒæ”¶
- âœ… M1 åŸºç¡€é€šè·¯ï¼ˆå·²å®Œæˆï¼‰
  - å½•éŸ³ â†’ æ–‡ä»¶è½åœ° â†’ FunASR å•æ¬¡è½¬å†™ â†’ ç²˜è´´/æ‰“å­—è¾“å‡ºï¼›F2 å¼€/å…³ï¼Œæ—¥å¿—è½åœ°ã€‚
- âœ… M2 å•æ¬¡è½¬å†™æ¨¡å¼ï¼ˆå·²å®Œæˆï¼‰
  - ä¼šè¯ç¼“å†²ä¸Žåˆå¹¶ã€å•æ¬¡è½¬å†™ã€è¾“å‡ºä¸Žæ—¥å¿—ï¼›åœæ­¢åŽè‡ªåŠ¨å¯¼å‡º `logs/recent.wav`ï¼›é…ç½®åŒ–è¾“å‡ºç­–ç•¥ã€‚
- âœ… M3 ç¨³å®šæ€§ä¸Žæ€§èƒ½ï¼ˆå·²å®Œæˆ v2.0ï¼‰
  - **å¼‚æ­¥è½¬å½•æž¶æž„**ï¼šåœæ­¢å½•éŸ³ç«‹å³è¿”å›žï¼Œå“åº”é€Ÿåº¦æå‡60å€ï¼ˆ3ç§’â†’50msï¼‰
  - **ä»»åŠ¡é˜Ÿåˆ—æœºåˆ¶**ï¼šæ”¯æŒå¿«é€Ÿè¿žç»­å½•éŸ³ï¼Œæœ€å¤š10ä¸ªä»»åŠ¡æŽ’é˜Ÿ
  - **å†…å­˜æ³„æ¼ä¿®å¤**ï¼šéŸ³é¢‘ç¼“å†²åŒºè‡ªåŠ¨æ¸…ç†ï¼ŒGPUæ˜¾å­˜å®šæœŸé‡Šæ”¾
  - **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨é”å’Œé˜Ÿåˆ—ä¿æŠ¤å…±äº«èµ„æº
  - **ä¼˜é›…æ¸…ç†**ï¼šç¨‹åºé€€å‡ºæ—¶ç­‰å¾…é˜Ÿåˆ—æ¸…ç©ºï¼ˆæœ€å¤š10ç§’è¶…æ—¶ï¼‰
  - å¼‚å¸¸å¤„ç†ï¼ˆæ— è®¾å¤‡ã€æƒé™ï¼‰ã€é…ç½®åŒ–ã€æ—¥å¿—å¢žå¼ºï¼ˆé˜Ÿåˆ—çŠ¶æ€ã€GPUä¿¡æ¯ï¼‰
- ðŸ”œ M4 å¯æ‰©å±•åŽç«¯ï¼ˆè§„åˆ’ä¸­ï¼‰
  - å¢žåŠ  `WhisperBackend` æˆ– `ONNXBackend`ï¼ŒæŽ¥å£ä¿æŒä¸å˜ï¼›é…ç½®åˆ‡æ¢ã€‚

### ä½ å…³å¿ƒçš„ç‚¹é€æ¡è½åœ° âœ…
- âœ… F2 å¼€å§‹/åœæ­¢ï¼šå¼€å§‹æ—¶æ¸…çŠ¶æ€ï¼Œåœæ­¢åŽç«‹å³è¿”å›žï¼ˆ~50msï¼‰ï¼Œè½¬å½•åœ¨åŽå°å¼‚æ­¥è¿›è¡Œ
- âœ… å‡†ç¡®çŽ‡ä¼˜å…ˆï¼šæ•´æ®µæäº¤ï¼Œå‡å°‘åˆ‡åˆ†è¯¯å·®ï¼›FunASRæ ‡ç‚¹æ¢å¤å·²é›†æˆ
- âœ… ç”¨æˆ·ä½“éªŒï¼šå¿«é€Ÿå“åº”ï¼Œæ”¯æŒå¿«é€Ÿè¿žç»­å½•éŸ³ï¼Œè½¬å½•æŒ‰é¡ºåºè‡ªåŠ¨è¾“å‡º
- âœ… å†…å­˜å®‰å…¨ï¼šè‡ªåŠ¨æ¸…ç†ç¼“å†²åŒºã€GPUæ˜¾å­˜ï¼Œæ— å†…å­˜æ³„æ¼
- âœ… éž GUIï¼šçº¯ CLI/åŽå°è¿›ç¨‹ï¼›åŽç»­è‹¥è¦ GUIï¼Œä»…åŒ…ä¸€å±‚è®¾ç½®é¢æ¿å³å¯
- ðŸ”œ "åƒ Ollama ä¸€æ ·å¯æ¢æ¨¡åž‹"ï¼šé€šè¿‡åŽç«¯é€‚é…å™¨ + é…ç½®é€‰æ‹©ï¼Œå…ˆ FunASRï¼ŒåŽç»­åŠ  whisper/onnx ä¹Ÿæ— éœ€æ”¹ä¸Šå±‚

### v2.0 æž¶æž„æ”¹è¿›è¯¦æƒ…ï¼ˆ2025-10-01ï¼‰

#### å¼‚æ­¥è½¬å½•æž¶æž„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»çº¿ç¨‹        â”‚  
â”‚  (UI/çƒ­é”®å“åº”)  â”‚  â† F2æŒ‰é”®ï¼Œç«‹å³å“åº” (~50ms)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ å½•éŸ³çº¿ç¨‹ â”‚  â† é‡‡é›†éŸ³é¢‘ï¼Œå¡«å……ç¼“å†²åŒº
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚ stop() æäº¤ä»»åŠ¡
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ä»»åŠ¡é˜Ÿåˆ—     â”‚  â† æœ€å¤š10ä¸ªä»»åŠ¡ (çº¿ç¨‹å®‰å…¨)
    â”‚  [1][2][3]   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ è½¬å½•çº¿ç¨‹ â”‚  â† åŽå°æŒç»­å¤„ç†ï¼ŒæŒ‰é¡ºåºè½¬å½•
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ è¾“å‡ºæ–‡å­— â”‚  â† è‡ªåŠ¨è¾“å…¥åˆ°ç„¦ç‚¹çª—å£
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæ”¹è¿›
1. **ç«‹å³å“åº”**ï¼šstop()ä»Žé˜»å¡ž3ç§’æ”¹ä¸ºç«‹å³è¿”å›ž50msï¼ˆæå‡60å€ï¼‰
2. **å¹¶å‘èƒ½åŠ›**ï¼šæ”¯æŒåŒæ—¶è¿›è¡Œï¼š1ä¸ªå½•éŸ³ + 1ä¸ªè½¬å½•
3. **é˜Ÿåˆ—ç¼“å†²**ï¼šæœ€å¤š10ä¸ªä»»åŠ¡æŽ’é˜Ÿï¼Œé˜²æ­¢å¿«é€Ÿè¿žç»­æ“ä½œä¸¢å¤±
4. **å†…å­˜å®‰å…¨**ï¼š
   - ç¼“å†²åŒºçº¿ç¨‹é”ä¿æŠ¤
   - å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿä¼šæ¸…ç†
   - GPUæ˜¾å­˜æ¯10æ¬¡è½¬å½•è‡ªåŠ¨æ¸…ç†
5. **çŠ¶æ€é€æ˜Ž**ï¼šæ—¥å¿—æ˜¾ç¤ºé˜Ÿåˆ—çŠ¶æ€ã€ä»»åŠ¡è¿›åº¦ã€å®Œæˆç»Ÿè®¡

#### æŠ€æœ¯å®žçŽ°
- ä½¿ç”¨ `queue.Queue`ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰è¿›è¡Œä»»åŠ¡ä¼ é€’
- ä½¿ç”¨ `threading.Lock` ä¿æŠ¤éŸ³é¢‘ç¼“å†²åŒºè®¿é—®
- ä½¿ç”¨ `threading.Event` è¿›è¡ŒçŠ¶æ€åŒæ­¥
- è½¬å½•å·¥ä½œçº¿ç¨‹åœ¨åˆå§‹åŒ–æ—¶å¯åŠ¨ï¼Œcleanupæ—¶ä¼˜é›…åœæ­¢
- ç¨‹åºé€€å‡ºå‰ç­‰å¾…é˜Ÿåˆ—æ¸…ç©ºï¼ˆæœ€å¤š10ç§’è¶…æ—¶ï¼‰

#### æ€§èƒ½æŒ‡æ ‡
- å“åº”å»¶è¿Ÿï¼š~50msï¼ˆåœæ­¢å½•éŸ³åˆ°è¿”å›žï¼‰
- é˜Ÿåˆ—å®¹é‡ï¼š10ä¸ªä»»åŠ¡
- å†…å­˜å ç”¨ï¼šæ¯ä»»åŠ¡çº¦2-5MBï¼ˆå–å†³äºŽå½•éŸ³æ—¶é•¿ï¼‰
- å¹¶å‘èƒ½åŠ›ï¼š1å½•éŸ³ + 1è½¬å½•åŒæ—¶è¿›è¡Œ